<div class="pl-0 pt-1 pb-2 col-md-12 mt-1 mb-1 header-route">
    <h4>Users</h4>
</div>
<div class="overlay" *ngIf="loading">
    <mat-progress-spinner id="spinUser" class="form-spinner" mode="indeterminate"></mat-progress-spinner>
    <mat-label class="label-overlay">Processing User...</mat-label>
</div>
<mat-card>
    <form [formGroup]="userForm" (ngSubmit)="onSubmit()">
        <div class="form-field pl-3 pr-3">
            <mat-form-field hintLabel="Email format">
                <input matInput #Email placeholder="Email" maxlength="200" pattern="^[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,4}$" formControlName="Email"
                    [errorStateMatcher]="confirmValidParentMatcher" required>
                <mat-error *ngIf="f.Email.invalid && f.Email.touched">{{getErrorMessage('Email')}}</mat-error>
            </mat-form-field>
        </div>
        <div class="form-field pl-3 pr-3">
            <mat-form-field hintLabel="Min 5 characters">
                <input matInput #UserName placeholder="Username" maxlength="50" minlength="5" formControlName="UserName"
                    [errorStateMatcher]="confirmValidParentMatcher" (focusout)="checkUserNameAvailability($event)" required>
                <mat-spinner matSuffix *ngIf="loadingUser" diameter="18" color="primary"></mat-spinner>
                <ng-container matSuffix *ngIf="availability$ | async as result">
                    <mat-icon *ngIf="userNameValidated" [ngClass]="{'icon-green':result.Available, 'icon-red':!result.Available}">{{result.Available ? 'check' : 'close' }}</mat-icon>
                </ng-container>
                <mat-error *ngIf="f.UserName.invalid && f.UserName.touched">{{getErrorMessage('UserName')}}</mat-error>
            </mat-form-field>
        </div>
        <div class="form-field pl-3 pr-3">
            <mat-form-field hintLabel="Min 5 characters">
                <input matInput #First_Name placeholder="First Name" maxlength="100" minlength="3" formControlName="First_Name"
                    [errorStateMatcher]="confirmValidParentMatcher" required>
                <mat-error *ngIf="f.First_Name.invalid && f.First_Name.touched">{{getErrorMessage('First_Name')}}</mat-error>
            </mat-form-field>
        </div>
        <div class="form-field pl-3 pr-3">
            <mat-form-field hintLabel="Min 5 characters">
                <input matInput #Last_Name placeholder="Last Name" maxlength="100" minlength="3" formControlName="Last_Name"
                    [errorStateMatcher]="confirmValidParentMatcher" required>
                <mat-error *ngIf="f.Last_Name.invalid && f.Last_Name.touched">{{getErrorMessage('Last_Name')}}</mat-error>
            </mat-form-field>
        </div>
        <div class="form-field pl-3 pr-3">
            <mat-form-field hintLabel="Min 6 characters">
                <input matInput #Password placeholder="Password" maxlength="20" minlength="6" formControlName="Password"
                    [errorStateMatcher]="confirmValidParentMatcher" [type]="hide ? 'password' : 'text'">
                <button mat-icon-button matSuffix (click)="hide = !hide" [attr.aria-label]="'Hide password'" [attr.aria-pressed]="hide">
                    <mat-icon>{{hide ? 'visibility_off' : 'visibility'}}</mat-icon>
                </button>
                <mat-error *ngIf="f.Password.invalid && f.Password.touched">{{getErrorMessage('Password')}}</mat-error>
            </mat-form-field>
        </div>
        <div class="form-field pl-3 pr-3">
            <mat-form-field>
                <mat-label>Default Store:</mat-label>
                    <mat-select formControlName="StoreId">
                        <mat-option *ngFor="let res of stores$ | async" [value]="res.StoreId">
                            {{res.Name}}
                        </mat-option>
                    </mat-select>
                    <mat-error *ngIf="f.StoreId.invalid && f.StoreId.touched">{{getErrorMessage('Store')}}</mat-error>
            </mat-form-field>
        </div>
        <div class="form-field-check ml-3 pr-3">
            <mat-checkbox formControlName="Is_Admin">Is Admin</mat-checkbox>
        </div>
        <div class="form-field-check ml-3 pr-3" *ngIf="userForm.value.UserId !== '' && userForm.value.UserId !== null">
            <mat-checkbox formControlName="Status">Status</mat-checkbox>
        </div>
        <button mat-flat-button color="primary" id="save" [disabled]="!userForm.valid" class="ml-3 mr-3 mt-2">Save</button>
        <button mat-flat-button color="accent" id="cancel" (click)="onCancel()" class="mt-2">Cancel</button>
        <!-- {{ userForm.value | json }} -->
    </form>
</mat-card>